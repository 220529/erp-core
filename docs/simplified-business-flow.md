# ERP-Core ç®€åŒ–ä¸šåŠ¡æµç¨‹æ–‡æ¡£

> ç²¾ç®€è®¾è®¡ã€ä¸šåŠ¡é—­ç¯ã€æµç¨‹é€å½» - è£…ä¿®ERPæ ¸å¿ƒæµç¨‹

## ğŸ“‹ è®¾è®¡ç†å¿µ

éµå¾ª"**ä¸è¿‡åº¦è®¾è®¡ï¼Œä¸šåŠ¡é—­ç¯ï¼Œæµç¨‹ç²¾ç®€**"åŸåˆ™ï¼Œå»é™¤å†—ä½™çš„é¡¹ç›®ï¼ˆProjectï¼‰æ¦‚å¿µï¼Œè®©è®¢å•ï¼ˆOrderï¼‰ç›´æ¥æ‰¿è½½æ–½å·¥ç®¡ç†èŒè´£ã€‚

---

## ğŸ—ï¸ æ ¸å¿ƒå®ä½“å…³ç³»

### ç®€åŒ–åçš„ ER å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     User      â”‚
                    â”‚   (ç”¨æˆ·è¡¨)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Customer     â”‚  â”‚CodeFlow    â”‚
            â”‚   (å®¢æˆ·è¡¨)      â”‚  â”‚(ä»£ç æµç¨‹è¡¨) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚           â”‚
  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
  â”‚CustomerFollowâ”‚   â”‚    â”‚   Order     â”‚
  â”‚ (è·Ÿè¿›è®°å½•è¡¨) â”‚   â”‚    â”‚  (è®¢å•è¡¨)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚           â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    â”‚             â”‚         â”‚
                â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”
                â”‚ Material  â”‚   â”‚OrderMaterialâ”‚ Payment â”‚
                â”‚ (ç‰©æ–™åº“)   â”‚   â”‚(è®¢å•ç‰©æ–™è¡¨)â”‚ (æ”¶æ¬¾è¡¨)â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒå®ä½“æ¸…å•

| å®ä½“ | è¡¨å | è¯´æ˜ | å…³é”®å­—æ®µ |
|------|------|------|---------|
| **User** | `users` | ç”¨æˆ·è¡¨ | `username`, `role`, `mobile` |
| **Customer** | `customers` | å®¢æˆ·ä¿¡æ¯ | `name`, `mobile`, `status`, `salesId` |
| **CustomerFollow** | `customer_follows` | å®¢æˆ·è·Ÿè¿›è®°å½• | `customerId`, `type`, `content` |
| **Order** | `orders` | è®¢å•ä¸»è¡¨ï¼ˆåŒ…å«æ–½å·¥ä¿¡æ¯ï¼‰ | `orderNo`, `customerId`, `totalAmount`, `status`, `foremanId` |
| **OrderMaterial** | `order_materials` | è®¢å•ç‰©æ–™æ˜ç»† | `orderId`, `materialId`, `quantity`, `amount` |
| **Material** | `materials` | ç‰©æ–™åº“ | `code`, `name`, `category`, `costPrice`, `salePrice` |
| **Payment** | `payments` | æ”¶æ¬¾è®°å½• | `paymentNo`, `orderId`, `type`, `amount`, `status` |
| **CodeFlow** | `code_flows` | åŠ¨æ€ä»£ç æµç¨‹ | `key`, `name`, `code`, `category` |

---

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### å®Œæ•´ä¸šåŠ¡æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è£…ä¿®ä¸šåŠ¡å…¨æµç¨‹é—­ç¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ ã€å®¢æˆ·è·å–ã€‘
   â†“
   çº¿ç´¢å½•å…¥ â†’ é”€å”®åˆ†é… â†’ ç”µè¯è·Ÿè¿›
   â”‚
   â”œâ”€ å®¢æˆ·ä¿¡æ¯ï¼šå§“åã€ç”µè¯ã€åœ°å€ã€æ¥æº
   â”œâ”€ è·Ÿè¿›è®°å½•ï¼šæ²Ÿé€šå†…å®¹ã€ä¸‹æ¬¡è·Ÿè¿›æ—¶é—´
   â””â”€ çŠ¶æ€ï¼šleadï¼ˆçº¿ç´¢ï¼‰

2ï¸âƒ£ ã€éœ€æ±‚ç¡®è®¤ã€‘
   â†“
   ä¸Šé—¨é‡æˆ¿ â†’ æ–¹æ¡ˆè®¾è®¡ â†’ æŠ¥ä»·ç¡®è®¤
   â”‚
   â”œâ”€ å®¢æˆ·çŠ¶æ€ï¼šmeasuredï¼ˆå·²é‡æˆ¿ï¼‰â†’ quotedï¼ˆå·²æŠ¥ä»·ï¼‰
   â”œâ”€ è®¢å•è‰ç¨¿ï¼šä¸»ææ¸…å•ã€äººå·¥è´¹ç”¨
   â””â”€ è®¢å•é‡‘é¢ï¼šsum(æ˜ç»†é‡‘é¢)

3ï¸âƒ£ ã€åˆåŒç­¾çº¦ã€‘
   â†“
   å®¢æˆ·ç­¾çº¦ â†’ åˆ›å»ºæ­£å¼è®¢å• â†’ åˆ¶å®šæ”¶æ¬¾è®¡åˆ’
   â”‚
   â”œâ”€ è®¢å•çŠ¶æ€ï¼šdraft â†’ signed
   â”œâ”€ å®¢æˆ·çŠ¶æ€ï¼šsignedï¼ˆå·²ç­¾çº¦ï¼‰
   â”œâ”€ æ”¶æ¬¾è®¡åˆ’ï¼šå®šé‡‘ã€åˆåŒæ¬¾ã€å°¾æ¬¾
   â””â”€ ç­¾çº¦æ—¶é—´ï¼šsignedAt

4ï¸âƒ£ ã€æ–½å·¥æ‰§è¡Œã€‘
   â†“
   å®šé‡‘åˆ°è´¦ â†’ åˆ†é…å·¥é•¿ â†’ è®¢å•å¼€å·¥
   â”‚
   â”œâ”€ å·¥é•¿åˆ†é…ï¼šforemanId
   â”œâ”€ è®¢å•çŠ¶æ€ï¼šsigned â†’ in_progress
   â””â”€ å¼€å·¥æ—¶é—´ï¼šstartedAt

5ï¸âƒ£ ã€æ–½å·¥ç®¡ç†ã€‘
   â†“
   æ–½å·¥è¿›åº¦è·Ÿè¸ª â†’ å¢é¡¹ç®¡ç† â†’ è´¨é‡éªŒæ”¶
   â”‚
   â”œâ”€ è¿›åº¦æ›´æ–°ï¼šè®¢å•çŠ¶æ€å®æ—¶åŒæ­¥
   â”œâ”€ å¢é¡¹å¤„ç†ï¼šè¿½åŠ è®¢å•æ˜ç»† â†’ å¢åŠ è®¢å•é‡‘é¢
   â””â”€ éªŒæ”¶ç¡®è®¤ï¼šè®¢å•çŠ¶æ€ â†’ completed

6ï¸âƒ£ ã€æ”¶æ¬¾ç»“ç®—ã€‘
   â†“
   åˆ†æœŸæ”¶æ¬¾ â†’ è´¢åŠ¡ç¡®è®¤ â†’ æ›´æ–°è®¢å•å·²æ”¶é‡‘é¢
   â”‚
   â”œâ”€ æ”¶æ¬¾è®°å½•ï¼špaymentNo, type, amount
   â”œâ”€ çŠ¶æ€æµè½¬ï¼špending â†’ confirmed
   â””â”€ è®¢å•æ›´æ–°ï¼špaidAmount += amount

7ï¸âƒ£ ã€è®¢å•äº¤ä»˜ã€‘
   â†“
   å·¥ç¨‹éªŒæ”¶ â†’ å°¾æ¬¾ç»“æ¸… â†’ è®¢å•å®Œå·¥ â†’ å®¢æˆ·å›è®¿
   â”‚
   â”œâ”€ è®¢å•çŠ¶æ€ï¼šcompleted
   â”œâ”€ å®¢æˆ·çŠ¶æ€ï¼šcompleted
   â””â”€ å®Œå·¥æ—¶é—´ï¼šcompletedAt

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      âœ… ä¸šåŠ¡é—­ç¯å®Œæˆ                            â”‚
â”‚  å®¢æˆ·æ•°æ® â†’ è®¢å•æ•°æ® â†’ æ”¶æ¬¾æ•°æ® â†’ å…¨éƒ¨å½’æ¡£                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š çŠ¶æ€æµè½¬

### 1. å®¢æˆ·çŠ¶æ€æµè½¬

```
leadï¼ˆçº¿ç´¢ï¼‰â†’ measuredï¼ˆå·²é‡æˆ¿ï¼‰â†’ quotedï¼ˆå·²æŠ¥ä»·ï¼‰â†’ signedï¼ˆå·²ç­¾çº¦ï¼‰â†’ completedï¼ˆå·²å®Œå·¥ï¼‰
```

**çŠ¶æ€è¯´æ˜ï¼š**
- `lead`ï¼šåˆå§‹çŠ¶æ€ï¼Œçº¿ç´¢å½•å…¥
- `measured`ï¼šä¸Šé—¨é‡æˆ¿å®Œæˆ
- `quoted`ï¼šæ–¹æ¡ˆæŠ¥ä»·å®Œæˆ
- `signed`ï¼šåˆåŒç­¾çº¦
- `completed`ï¼šè®¢å•å®Œå·¥ï¼Œå®¢æˆ·å®Œæˆ

### 2. è®¢å•çŠ¶æ€æµè½¬

```
draftï¼ˆè‰ç¨¿ï¼‰â†’ signedï¼ˆå·²ç­¾çº¦ï¼‰â†’ in_progressï¼ˆæ–½å·¥ä¸­ï¼‰â†’ completedï¼ˆå·²å®Œå·¥ï¼‰
                                                     â†“
                                               cancelledï¼ˆå·²å–æ¶ˆï¼‰
```

**çŠ¶æ€è¯´æ˜ï¼š**
- `draft`ï¼šè®¢å•è‰ç¨¿ï¼Œå¯ç¼–è¾‘
- `signed`ï¼šå·²ç­¾çº¦ï¼Œä¸å¯ä¿®æ”¹åŸºæœ¬ä¿¡æ¯
- `in_progress`ï¼šæ–½å·¥ä¸­ï¼Œå·¥é•¿å·²åˆ†é…
- `completed`ï¼šæ–½å·¥å®Œæˆï¼ŒéªŒæ”¶é€šè¿‡
- `cancelled`ï¼šè®¢å•å–æ¶ˆ

### 3. æ”¶æ¬¾çŠ¶æ€æµè½¬

```
pendingï¼ˆå¾…ç¡®è®¤ï¼‰â†’ confirmedï¼ˆå·²ç¡®è®¤ï¼‰
                 â†“
            cancelledï¼ˆå·²å–æ¶ˆï¼‰
```

---

## ğŸ¬ å®Œæ•´ä¸šåŠ¡æ¡ˆä¾‹ï¼šå¼ ä¸‰çš„è£…ä¿®ä¹‹æ—…

### Day 1: å®¢æˆ·çº¿ç´¢å½•å…¥

**æ“ä½œï¼š** é”€å”®å°ç‹æ¥åˆ°ç”µè¯ï¼Œå½•å…¥å®¢æˆ·ä¿¡æ¯

```javascript
POST /api/code/run/customer_create
{
  "params": {
    "name": "å¼ ä¸‰",
    "mobile": "13800138000",
    "address": "åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO"
  }
}
```

**æ•°æ®å˜åŒ–ï¼š**
```sql
INSERT INTO customers (name, mobile, address, status, sales_id)
VALUES ('å¼ ä¸‰', '13800138000', 'åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO', 'lead', 1001);
```

**æ•°æ®çŠ¶æ€ï¼š**
- customers: 1æ¡ï¼ˆå¼ ä¸‰ï¼Œstatus='lead'ï¼‰

---

### Day 5: ä¸Šé—¨é‡æˆ¿

**æ“ä½œï¼š** å°ç‹å¸¦è®¾è®¡å¸ˆä¸Šé—¨é‡æˆ¿

```javascript
POST /api/code/run/customer_measure
{
  "params": {
    "customerId": 1,
    "content": "å»ºç­‘é¢ç§¯120å¹³ï¼Œç°ä»£ç®€çº¦é£æ ¼",
    "designerId": 2001
  }
}
```

**æ•°æ®å˜åŒ–ï¼š**
```sql
-- æ›´æ–°å®¢æˆ·çŠ¶æ€
UPDATE customers 
SET status='measured', designer_id=2001 
WHERE id=1;

-- æ’å…¥è·Ÿè¿›è®°å½•
INSERT INTO customer_follows (customer_id, type, content)
VALUES (1, 'measure', 'å»ºç­‘é¢ç§¯120å¹³...');
```

**æ•°æ®çŠ¶æ€ï¼š**
- customers: 1æ¡ï¼ˆstatus='measured' âœ…ï¼‰
- customer_follows: 1æ¡

---

### Day 8: æ–¹æ¡ˆæŠ¥ä»·ï¼Œåˆ›å»ºè®¢å•è‰ç¨¿

**æ“ä½œï¼š** è®¾è®¡å¸ˆåˆ¶ä½œæŠ¥ä»·å•

```javascript
POST /api/code/run/order_create_draft
{
  "params": {
    "customerId": 1,
    "materials": [
      { "materialName": "å®¢å…åœ°ç –", "category": "main", "quantity": 100, "unit": "å¹³ç±³", "price": 150 },
      { "materialName": "æ°´ç”µæ”¹é€ ", "category": "labor", "quantity": 1, "unit": "é¡¹", "price": 15000 }
    ],
    "remark": "ç°ä»£ç®€çº¦é£æ ¼"
  }
}
```

**æ•°æ®å˜åŒ–ï¼š**
```sql
-- æ’å…¥è®¢å•
INSERT INTO orders (order_no, customer_id, total_amount, status, sales_id, designer_id)
VALUES ('ORD202510300001', 1, 30000.00, 'draft', 1001, 2001);

-- æ’å…¥è®¢å•æ˜ç»†
INSERT INTO order_materials (order_id, material_name, category, quantity, unit, price, amount)
VALUES 
  (1, 'å®¢å…åœ°ç –', 'main', 100, 'å¹³ç±³', 150, 15000),
  (1, 'æ°´ç”µæ”¹é€ ', 'labor', 1, 'é¡¹', 15000, 15000);

-- æ›´æ–°å®¢æˆ·çŠ¶æ€
UPDATE customers SET status='quoted' WHERE id=1;
```

**æ•°æ®çŠ¶æ€ï¼š**
- customers: 1æ¡ï¼ˆstatus='quoted' âœ…ï¼‰
- orders: 1æ¡ï¼ˆstatus='draft', totalAmount=30000ï¼‰
- order_materials: 2æ¡

---

### Day 10: åˆåŒç­¾çº¦

**æ“ä½œï¼š** å®¢æˆ·ç­¾çº¦ï¼Œæ”¯ä»˜å®šé‡‘

```javascript
POST /api/code/run/order_sign
{
  "params": {
    "orderId": 1,
    "depositAmount": 10000,
    "paymentMethod": "bank_transfer"
  }
}
```

**æ•°æ®å˜åŒ–ï¼š**
```sql
-- æ›´æ–°è®¢å•çŠ¶æ€
UPDATE orders 
SET status='signed', signed_at=NOW() 
WHERE id=1;

-- æ’å…¥æ”¶æ¬¾è®°å½•
INSERT INTO payments (payment_no, order_id, type, amount, method, status)
VALUES ('PAY202510300001', 1, 'deposit', 10000.00, 'bank_transfer', 'pending');

-- æ›´æ–°å®¢æˆ·çŠ¶æ€
UPDATE customers SET status='signed' WHERE id=1;
```

**æ•°æ®çŠ¶æ€ï¼š**
- customers: 1æ¡ï¼ˆstatus='signed' âœ…ï¼‰
- orders: 1æ¡ï¼ˆstatus='signed' âœ…ï¼‰
- payments: 1æ¡ï¼ˆstatus='pending'ï¼‰

---

### Day 10: è´¢åŠ¡ç¡®è®¤æ”¶æ¬¾

**æ“ä½œï¼š** è´¢åŠ¡ç¡®è®¤å®šé‡‘åˆ°è´¦

```javascript
POST /api/code/run/payment_confirm
{
  "params": {
    "paymentId": 1,
    "paidAt": "2025-10-30 15:30:00"
  }
}
```

**æ•°æ®å˜åŒ–ï¼š**
```sql
-- æ›´æ–°æ”¶æ¬¾çŠ¶æ€
UPDATE payments 
SET status='confirmed', paid_at='2025-10-30 15:30:00' 
WHERE id=1;

-- æ›´æ–°è®¢å•å·²æ”¶é‡‘é¢
UPDATE orders 
SET paid_amount = paid_amount + 10000.00 
WHERE id=1;
```

**æ•°æ®çŠ¶æ€ï¼š**
- payments: 1æ¡ï¼ˆstatus='confirmed' âœ…ï¼‰
- orders: 1æ¡ï¼ˆpaidAmount=10000 âœ…ï¼‰

---

### Day 12: åˆ†é…å·¥é•¿ï¼Œè®¢å•å¼€å·¥

**æ“ä½œï¼š** è®¢å•å¼€å·¥

```javascript
POST /api/code/run/order_start
{
  "params": {
    "orderId": 1,
    "foremanId": 3001
  }
}
```

**æ•°æ®å˜åŒ–ï¼š**
```sql
-- æ›´æ–°è®¢å•çŠ¶æ€
UPDATE orders 
SET status='in_progress', foreman_id=3001, started_at=NOW() 
WHERE id=1;
```

**æ•°æ®çŠ¶æ€ï¼š**
- orders: 1æ¡ï¼ˆstatus='in_progress', foremanId=3001, startedAt=NOW() âœ…ï¼‰

---

### Day 70: æ–½å·¥å®Œæˆï¼Œè®¢å•å®Œå·¥

**æ“ä½œï¼š** å·¥é•¿ç¡®è®¤å®Œå·¥

```javascript
POST /api/code/run/order_complete
{
  "params": {
    "orderId": 1
  }
}
```

**æ•°æ®å˜åŒ–ï¼š**
```sql
-- æ›´æ–°è®¢å•çŠ¶æ€
UPDATE orders 
SET status='completed', completed_at=NOW() 
WHERE id=1;

-- æ›´æ–°å®¢æˆ·çŠ¶æ€
UPDATE customers SET status='completed' WHERE id=1;
```

**æ•°æ®çŠ¶æ€ï¼ˆæœ€ç»ˆï¼‰ï¼š**
- customers: 1æ¡ï¼ˆstatus='completed' âœ…ï¼‰
- orders: 1æ¡ï¼ˆstatus='completed', completedAt=NOW() âœ…ï¼‰
- payments: 1æ¡ï¼ˆamount=10000, status='confirmed'ï¼‰

---

## ğŸ”‘ å…³é”®ä¸šåŠ¡è§„åˆ™

### 1. è®¢å•ç®¡ç†è§„åˆ™

```javascript
// è®¢å•ç¼–å·è‡ªåŠ¨ç”Ÿæˆ
orderNo = 'ORD' + YYYYMMDD + åºå·ï¼ˆ4ä½ï¼‰

// è®¢å•æ€»é‡‘é¢ = æ‰€æœ‰è®¢å•æ˜ç»†é‡‘é¢ä¹‹å’Œ
order.totalAmount = sum(orderMaterials.amount)

// è®¢å•æ˜ç»†é‡‘é¢ = æ•°é‡ Ã— å•ä»·
orderMaterial.amount = quantity Ã— price

// è®¢å•å¯æ”¶é‡‘é¢æ ¡éªŒ
order.paidAmount <= order.totalAmount

// è®¢å•å¿…é¡»æœ‰é”€å”®ã€è®¾è®¡å¸ˆ
order.salesId !== null
order.designerId !== null

// æ–½å·¥ä¸­çš„è®¢å•å¿…é¡»æœ‰å·¥é•¿
if (order.status === 'in_progress') {
  order.foremanId !== null
}
```

### 2. å®¢æˆ·ç®¡ç†è§„åˆ™

```javascript
// å®¢æˆ·çŠ¶æ€åªèƒ½å•å‘æµè½¬
lead â†’ measured â†’ quoted â†’ signed â†’ completed

// å®¢æˆ·å¿…é¡»æœ‰è´Ÿè´£é”€å”®
customer.salesId !== null

// ç­¾çº¦å®¢æˆ·å¿…é¡»æœ‰è®¾è®¡å¸ˆ
if (customer.status === 'signed') {
  customer.designerId !== null
}
```

### 3. æ”¶æ¬¾ç®¡ç†è§„åˆ™

```javascript
// æ”¶æ¬¾å•å·è‡ªåŠ¨ç”Ÿæˆ
paymentNo = 'PAY' + YYYYMMDD + åºå·ï¼ˆ4ä½ï¼‰

// æ”¶æ¬¾é‡‘é¢å¿…é¡»å¤§äº0
payment.amount > 0

// è®¢å•å·²æ”¶é‡‘é¢ = æ‰€æœ‰å·²ç¡®è®¤æ”¶æ¬¾ä¹‹å’Œ
order.paidAmount = sum(payments.amount WHERE status='confirmed')

// æ”¶æ¬¾ä¸èƒ½è¶…è¿‡è®¢å•æ€»é¢
order.paidAmount <= order.totalAmount
```

---

## ğŸ‘¥ è§’è‰²ä¸æƒé™

### è§’è‰²å®šä¹‰

```typescript
export enum UserRole {
  ADMIN = 'admin',        // ç³»ç»Ÿç®¡ç†å‘˜
  SALES = 'sales',        // é”€å”®
  DESIGNER = 'designer',  // è®¾è®¡å¸ˆ
  FOREMAN = 'foreman',    // å·¥é•¿
  FINANCE = 'finance',    // è´¢åŠ¡
}
```

### æƒé™çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | ç®¡ç†å‘˜ | é”€å”® | è®¾è®¡å¸ˆ | å·¥é•¿ | è´¢åŠ¡ |
|---------|-------|------|--------|------|------|
| **å®¢æˆ·ç®¡ç†** | âœ… | âœ… | âŒ | âŒ | âŒ |
| åˆ›å»ºå®¢æˆ· | âœ… | âœ… | âŒ | âŒ | âŒ |
| å®¢æˆ·è·Ÿè¿› | âœ… | âœ… | âœ… | âŒ | âŒ |
| **è®¢å•ç®¡ç†** | âœ… | âœ… | âœ… | âŒ | âŒ |
| åˆ›å»ºè®¢å• | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç¼–è¾‘æ˜ç»† | âœ… | âœ… | âœ… | âŒ | âŒ |
| è®¢å•ç­¾çº¦ | âœ… | âœ… | âŒ | âŒ | âŒ |
| è®¢å•å¼€å·¥ | âœ… | âœ… | âŒ | âœ… | âŒ |
| è®¢å•å®Œå·¥ | âœ… | âŒ | âŒ | âœ… | âŒ |
| **æ”¶æ¬¾ç®¡ç†** | âœ… | âŒ | âŒ | âŒ | âœ… |
| åˆ›å»ºæ”¶æ¬¾ | âœ… | âŒ | âŒ | âŒ | âœ… |
| ç¡®è®¤æ”¶æ¬¾ | âœ… | âŒ | âŒ | âŒ | âœ… |

---

## ğŸ“Š ä¸è€ç³»ç»Ÿçš„å¯¹æ¯”

### è€ç³»ç»Ÿæµç¨‹

```
å®¢æˆ·åˆ›å»º â†’ å®¢æˆ·è¯¦æƒ… â†’ è½¬è®¢å•ï¼ˆé€‰å¥—é¤ï¼‰â†’ è®¢å•è¯¦æƒ…ï¼ˆå®Œå–„ææ–™ï¼‰â†’ è®¢å•çŠ¶æ€æµè½¬ â†’ è´¢åŠ¡æ”¶æ¬¾
```

### æ–°ç³»ç»Ÿæµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰

```
å®¢æˆ·åˆ›å»º â†’ å®¢æˆ·è·Ÿè¿› â†’ åˆ›å»ºè®¢å•è‰ç¨¿ â†’ è®¢å•ç­¾çº¦ â†’ è®¢å•å¼€å·¥ï¼ˆåˆ†é…å·¥é•¿ï¼‰â†’ è®¢å•å®Œå·¥ â†’ è´¢åŠ¡æ”¶æ¬¾
```

### æ ¸å¿ƒå˜åŒ–

| é¡¹ç›® | è€ç³»ç»Ÿ | æ–°ç³»ç»Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰ | è¯´æ˜ |
|------|-------|----------------|------|
| **é¡¹ç›®è¡¨** | âŒ æ—  | âŒ æ—  | å»é™¤å†—ä½™çš„é¡¹ç›®æ¦‚å¿µ |
| **è®¢å•èŒè´£** | å•†åŠ¡ | å•†åŠ¡ + æ–½å·¥ | è®¢å•ç›´æ¥ç®¡ç†æ–½å·¥çŠ¶æ€ |
| **æ–½å·¥ç®¡ç†** | åœ¨è®¢å•ä¸­ | åœ¨è®¢å•ä¸­ | foremanIdã€startedAtã€completedAt |
| **æ•°æ®æµè½¬** | å®¢æˆ·â†’è®¢å•â†’æ”¶æ¬¾ | å®¢æˆ·â†’è®¢å•â†’æ”¶æ¬¾ | **å®Œå…¨ä¸€è‡´** âœ… |

---

## ğŸ’¡ ç®€åŒ–è®¾è®¡çš„ä¼˜åŠ¿

### 1. **æ•°æ®ç»“æ„æ›´ç®€å•**
- åªéœ€ç»´æŠ¤ Customerã€Orderã€Payment ä¸‰å¼ ä¸»è¡¨
- å‡å°‘è¡¨å…³è”ï¼Œé™ä½æŸ¥è¯¢å¤æ‚åº¦

### 2. **ä¸šåŠ¡æµç¨‹æ›´æ¸…æ™°**
- å®¢æˆ· â†’ è®¢å• â†’ æ”¶æ¬¾ï¼Œä¸€æ¡ä¸»çº¿
- è®¢å•çŠ¶æ€ç›´æ¥åæ˜ æ–½å·¥è¿›åº¦

### 3. **å¼€å‘æˆæœ¬æ›´ä½**
- å‡å°‘å†—ä½™çš„ CRUD æ¥å£
- å‡å°‘çŠ¶æ€åŒæ­¥é€»è¾‘

### 4. **æ˜“äºç†è§£å’Œç»´æŠ¤**
- æ–°äººä¸Šæ‰‹å¿«
- ä»£ç é€»è¾‘ç®€å•

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **è®¢å•æ˜¯æ ¸å¿ƒ**ï¼šè®¢å•æ‰¿è½½å•†åŠ¡+æ–½å·¥åŒé‡èŒè´£
2. **çŠ¶æ€é©±åŠ¨**ï¼šé€šè¿‡çŠ¶æ€æµè½¬é©±åŠ¨ä¸šåŠ¡æ¨è¿›
3. **è§’è‰²åä½œ**ï¼šé”€å”®ã€è®¾è®¡å¸ˆã€å·¥é•¿ã€è´¢åŠ¡å„å¸å…¶èŒ
4. **æ•°æ®é—­ç¯**ï¼šå®¢æˆ·â†’è®¢å•â†’æ”¶æ¬¾ï¼Œå½¢æˆå®Œæ•´ä¸šåŠ¡é—­ç¯

### æŠ€æœ¯æ¶æ„

```
erp-code (ä¸šåŠ¡é€»è¾‘ï¼Œçƒ­æ›´æ–°)
    â†• HTTP API
erp-core (åŸºç¡€è®¾æ–½ï¼ŒTypeORM + NestJS)
    â†•
MySQL 8.0 æ•°æ®åº“
```

---

**ç‰ˆæœ¬**: v2.0ï¼ˆç®€åŒ–ç‰ˆï¼‰  
**æ›´æ–°æ—¥æœŸ**: 2025-10-31  
**ç»´æŠ¤äºº**: ERP å¼€å‘å›¢é˜Ÿ


