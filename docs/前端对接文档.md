# ERPç³»ç»Ÿå‰ç«¯å¯¹æ¥æ–‡æ¡£

## ğŸ“‹ ä¸šåŠ¡æµç¨‹æ€»è§ˆ

```
å®¢æˆ·è·å– â†’ å®¢æˆ·è·Ÿè¿› â†’ é€‰æ‹©å¥—é¤ â†’ åˆ›å»ºè®¢å• â†’ ç­¾çº¦æ”¶æ¬¾ â†’ æ–½å·¥ç®¡ç† â†’ é¡¹ç›®å®Œå·¥
```

---

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 1. å®¢æˆ·ç®¡ç†æµç¨‹

```
çº¿ç´¢å½•å…¥ â†’ ç”µè¯è·Ÿè¿› â†’ ä¸Šé—¨é‡æˆ¿ â†’ æ–¹æ¡ˆæŠ¥ä»· â†’ ç­¾çº¦ â†’ å®Œå·¥
(lead)     (lead)      (measured)   (quoted)   (signed) (completed)
```

**é¡µé¢**ï¼šå®¢æˆ·åˆ—è¡¨ã€å®¢æˆ·è¯¦æƒ…

**æ ¸å¿ƒå­—æ®µ**ï¼š
```typescript
{
  id: number;
  name: string;           // å®¢æˆ·å§“å
  mobile: string;         // æ‰‹æœºå·
  address: string;        // åœ°å€
  status: 'lead' | 'measured' | 'quoted' | 'signed' | 'completed';
  salesId: number;        // é”€å”®ID
  designerId: number;     // è®¾è®¡å¸ˆID
}
```

---

### 2. å¥—é¤é€‰æ‹©æµç¨‹

**é¡µé¢**ï¼šå¥—é¤åˆ—è¡¨ï¼ˆå¼¹çª—é€‰æ‹©ï¼‰

**æ ¸å¿ƒå­—æ®µ**ï¼š
```typescript
{
  id: number;
  code: string;           // å¥—é¤ç¼–ç 
  name: string;           // å¥—é¤åç§°ï¼ˆå¦‚ï¼šç°ä»£ç®€çº¦ä¸‰å±…å®¤å¥—é¤ï¼‰
  costPrice: number;      // æˆæœ¬ä»·
  salePrice: number;      // å”®ä»·
  description: string;    // æè¿°
  status: 'active' | 'inactive';
}
```

---

### 3. è®¢å•ç®¡ç†æµç¨‹

```
è‰ç¨¿ â†’ ç­¾çº¦ â†’ æ–½å·¥ä¸­ â†’ å®Œå·¥/å–æ¶ˆ
(draft) (signed) (in_progress) (completed/cancelled)
```

**é¡µé¢**ï¼šè®¢å•åˆ—è¡¨ã€è®¢å•è¯¦æƒ…

**æ ¸å¿ƒå­—æ®µ**ï¼š
```typescript
{
  id: number;
  orderNo: string;        // è®¢å•ç¼–å·
  customerId: number;     // å®¢æˆ·ID
  status: 'draft' | 'signed' | 'in_progress' | 'completed' | 'cancelled';
  
  // é‡‘é¢
  totalAmount: number;    // è®¢å•æ€»é‡‘é¢
  paidAmount: number;     // å·²æ”¶é‡‘é¢
  costAmount: number;     // æˆæœ¬é‡‘é¢
  
  // äººå‘˜
  salesId: number;        // é”€å”®
  designerId: number;     // è®¾è®¡å¸ˆ
  foremanId: number;      // å·¥é•¿
  
  // æ—¶é—´
  signedAt: Date;         // ç­¾çº¦æ—¶é—´
  startedAt: Date;        // å¼€å·¥æ—¶é—´
  completedAt: Date;      // å®Œå·¥æ—¶é—´
}
```

**è®¢å•æ˜ç»†å­—æ®µ**ï¼š
```typescript
{
  id: number;
  orderId: number;
  materialName: string;   // ç‰©æ–™åç§°
  category: 'main' | 'auxiliary' | 'labor' | 'addition'; // ä¸»æ/è¾…æ/äººå·¥/å¢é¡¹
  quantity: number;       // æ•°é‡
  unit: string;          // å•ä½
  price: number;         // å•ä»·
  amount: number;        // å°è®¡ï¼ˆquantity Ã— priceï¼‰
}
```

---

### 4. æ”¶æ¬¾ç®¡ç†æµç¨‹

```
å¾…ç¡®è®¤ â†’ å·²ç¡®è®¤/å·²å–æ¶ˆ
(pending) (confirmed/cancelled)
```

**é¡µé¢**ï¼šæ”¶æ¬¾åˆ—è¡¨ã€æ”¶æ¬¾è¯¦æƒ…

**æ ¸å¿ƒå­—æ®µ**ï¼š
```typescript
{
  id: number;
  paymentNo: string;      // æ”¶æ¬¾å•å·
  orderId: number;        // è®¢å•ID
  type: 'deposit' | 'contract' | 'design_fee' | 'addition'; // å®šé‡‘/åˆåŒæ¬¾/è®¾è®¡è´¹/å¢é¡¹
  amount: number;         // é‡‘é¢
  method: string;         // æ”¶æ¬¾æ–¹å¼ï¼ˆç°é‡‘/è½¬è´¦/æ”¯ä»˜å®/å¾®ä¿¡ï¼‰
  status: 'pending' | 'confirmed' | 'cancelled';
  paidAt: Date;          // å®é™…æ”¶æ¬¾æ—¶é—´
}
```

---

## ğŸ”„ å…³é”®ä¸šåŠ¡æ“ä½œ

### æ“ä½œ1ï¼šåˆ›å»ºå®¢æˆ·
```
POST /api/customers
{
  "name": "å¼ ä¸‰",
  "mobile": "13800138000",
  "address": "åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO"
}
```

### æ“ä½œ2ï¼šå®¢æˆ·é‡æˆ¿
```
POST /api/code/run/customer_measure
{
  "params": {
    "customerId": 1,
    "content": "120å¹³ï¼Œç°ä»£ç®€çº¦",
    "designerId": 2001
  }
}
```
**æ•ˆæœ**ï¼šå®¢æˆ·çŠ¶æ€ â†’ `measured`

### æ“ä½œ3ï¼šé€‰å¥—é¤åˆ›å»ºè®¢å•
```
POST /api/code/run/order_create_from_product
{
  "params": {
    "customerId": 1,
    "productId": 1,
    "remark": "å¤‡æ³¨"
  }
}
```
**æ•ˆæœ**ï¼š
- åˆ›å»ºè®¢å•ï¼ˆstatus=draftï¼‰
- è‡ªåŠ¨å¤åˆ¶å¥—é¤ç‰©æ–™åˆ°è®¢å•æ˜ç»†
- å®¢æˆ·çŠ¶æ€ â†’ `quoted`

### æ“ä½œ4ï¼šè°ƒæ•´è®¢å•æ˜ç»†
```
PUT /api/code/run/order_material_update
{
  "params": {
    "orderMaterialId": 1,
    "quantity": 120,
    "price": 200
  }
}
```
**æ•ˆæœ**ï¼šé‡æ–°è®¡ç®—è®¢å•æ€»é‡‘é¢

### æ“ä½œ5ï¼šè®¢å•ç­¾çº¦
```
POST /api/code/run/order_sign
{
  "params": {
    "orderId": 1,
    "depositAmount": 10000,
    "paymentMethod": "bank_transfer"
  }
}
```
**æ•ˆæœ**ï¼š
- è®¢å•çŠ¶æ€ â†’ `signed`
- åˆ›å»ºå®šé‡‘æ”¶æ¬¾è®°å½•ï¼ˆstatus=pendingï¼‰
- å®¢æˆ·çŠ¶æ€ â†’ `signed`

### æ“ä½œ6ï¼šè´¢åŠ¡ç¡®è®¤æ”¶æ¬¾
```
POST /api/code/run/payment_confirm
{
  "params": {
    "paymentId": 1,
    "paidAt": "2025-10-31 15:00:00"
  }
}
```
**æ•ˆæœ**ï¼š
- æ”¶æ¬¾çŠ¶æ€ â†’ `confirmed`
- è®¢å•å·²æ”¶é‡‘é¢ += æ”¶æ¬¾é‡‘é¢

### æ“ä½œ7ï¼šè®¢å•å¼€å·¥
```
POST /api/code/run/order_start
{
  "params": {
    "orderId": 1,
    "foremanId": 3001
  }
}
```
**æ•ˆæœ**ï¼šè®¢å•çŠ¶æ€ â†’ `in_progress`

### æ“ä½œ8ï¼šè®¢å•å®Œå·¥
```
POST /api/code/run/order_complete
{
  "params": {
    "orderId": 1
  }
}
```
**æ•ˆæœ**ï¼š
- è®¢å•çŠ¶æ€ â†’ `completed`
- å®¢æˆ·çŠ¶æ€ â†’ `completed`

---

## ğŸ“Š é¡µé¢åŠŸèƒ½æ¸…å•

### å®¢æˆ·ç®¡ç†
| é¡µé¢ | åŠŸèƒ½ |
|------|------|
| å®¢æˆ·åˆ—è¡¨ | æŸ¥çœ‹ã€æœç´¢ã€ç­›é€‰ï¼ˆæŒ‰çŠ¶æ€ï¼‰ã€åˆ›å»ºå®¢æˆ· |
| å®¢æˆ·è¯¦æƒ… | æŸ¥çœ‹ä¿¡æ¯ã€è·Ÿè¿›è®°å½•ã€è½¬è®¢å• |

### å¥—é¤ç®¡ç†
| é¡µé¢ | åŠŸèƒ½ |
|------|------|
| å¥—é¤åˆ—è¡¨ | æŸ¥çœ‹ã€åˆ›å»ºå¥—é¤ã€ç¼–è¾‘å¥—é¤ |
| å¥—é¤è¯¦æƒ… | æŸ¥çœ‹ç‰©æ–™æ¸…å•ã€ç¼–è¾‘ç‰©æ–™ |

### è®¢å•ç®¡ç†
| é¡µé¢ | åŠŸèƒ½ |
|------|------|
| è®¢å•åˆ—è¡¨ | æŸ¥çœ‹ã€æœç´¢ã€ç­›é€‰ï¼ˆæŒ‰çŠ¶æ€ï¼‰|
| è®¢å•è¯¦æƒ… | æŸ¥çœ‹ä¿¡æ¯ã€ç¼–è¾‘æ˜ç»†ã€ç­¾çº¦ã€å¼€å·¥ã€å®Œå·¥ |

### æ”¶æ¬¾ç®¡ç†
| é¡µé¢ | åŠŸèƒ½ |
|------|------|
| æ”¶æ¬¾åˆ—è¡¨ | æŸ¥çœ‹ã€æœç´¢ã€ç­›é€‰ï¼ˆæŒ‰çŠ¶æ€ï¼‰ã€åˆ›å»ºæ”¶æ¬¾ |
| æ”¶æ¬¾è¯¦æƒ… | æŸ¥çœ‹ä¿¡æ¯ã€ç¡®è®¤æ”¶æ¬¾ |

---

## ğŸ¨ çŠ¶æ€æ ·å¼å»ºè®®

### å®¢æˆ·çŠ¶æ€
```typescript
const statusMap = {
  lead: { text: 'çº¿ç´¢', color: 'gray' },
  measured: { text: 'å·²é‡æˆ¿', color: 'blue' },
  quoted: { text: 'å·²æŠ¥ä»·', color: 'orange' },
  signed: { text: 'å·²ç­¾çº¦', color: 'green' },
  completed: { text: 'å·²å®Œå·¥', color: 'purple' }
}
```

### è®¢å•çŠ¶æ€
```typescript
const statusMap = {
  draft: { text: 'è‰ç¨¿', color: 'gray' },
  signed: { text: 'å·²ç­¾çº¦', color: 'green' },
  in_progress: { text: 'æ–½å·¥ä¸­', color: 'blue' },
  completed: { text: 'å·²å®Œå·¥', color: 'purple' },
  cancelled: { text: 'å·²å–æ¶ˆ', color: 'red' }
}
```

### æ”¶æ¬¾çŠ¶æ€
```typescript
const statusMap = {
  pending: { text: 'å¾…ç¡®è®¤', color: 'orange' },
  confirmed: { text: 'å·²ç¡®è®¤', color: 'green' },
  cancelled: { text: 'å·²å–æ¶ˆ', color: 'red' }
}
```

---

## ğŸ” æƒé™è¯´æ˜

| è§’è‰² | æƒé™ |
|------|------|
| **é”€å”®** | å®¢æˆ·ç®¡ç†ã€è®¢å•åˆ›å»º/ç­¾çº¦ |
| **è®¾è®¡å¸ˆ** | å®¢æˆ·è·Ÿè¿›ã€å¥—é¤é€‰æ‹©ã€è®¢å•æ˜ç»†ç¼–è¾‘ |
| **å·¥é•¿** | è®¢å•å¼€å·¥/å®Œå·¥ |
| **è´¢åŠ¡** | æ”¶æ¬¾ç¡®è®¤ |
| **ç®¡ç†å‘˜** | å…¨éƒ¨æƒé™ |

---

## ğŸ“ æ•°æ®å­—å…¸

### ç‰©æ–™ç±»åˆ«
- `main` - ä¸»æï¼ˆåœ°ç –ã€åœ°æ¿ç­‰ï¼‰
- `auxiliary` - è¾…æï¼ˆæ°´æ³¥ã€ç”µçº¿ç­‰ï¼‰
- `labor` - äººå·¥
- `addition` - å¢é¡¹

### æ”¶æ¬¾ç±»å‹
- `deposit` - å®šé‡‘
- `contract` - åˆåŒæ¬¾
- `design_fee` - è®¾è®¡è´¹
- `addition` - å¢é¡¹æ¬¾

### æ”¶æ¬¾æ–¹å¼
- `cash` - ç°é‡‘
- `bank_transfer` - é“¶è¡Œè½¬è´¦
- `alipay` - æ”¯ä»˜å®
- `wechat` - å¾®ä¿¡

---

## ğŸš€ å¼€å‘å»ºè®®

### 1. é¡µé¢è·¯ç”±
```
/customers          # å®¢æˆ·åˆ—è¡¨
/customers/:id      # å®¢æˆ·è¯¦æƒ…
/products           # å¥—é¤åˆ—è¡¨
/products/:id       # å¥—é¤è¯¦æƒ…
/orders             # è®¢å•åˆ—è¡¨
/orders/:id         # è®¢å•è¯¦æƒ…
/payments           # æ”¶æ¬¾åˆ—è¡¨
/payments/:id       # æ”¶æ¬¾è¯¦æƒ…
```

### 2. å…³é”®äº¤äº’

**å®¢æˆ·è¯¦æƒ…é¡µ-è½¬è®¢å•**ï¼š
1. ç‚¹å‡»"è½¬è®¢å•"æŒ‰é’®
2. å¼¹å‡ºå¥—é¤é€‰æ‹©å¯¹è¯æ¡†
3. é€‰æ‹©å¥—é¤åè‡ªåŠ¨åˆ›å»ºè®¢å•
4. è·³è½¬åˆ°è®¢å•è¯¦æƒ…é¡µ

**è®¢å•è¯¦æƒ…é¡µ-æ˜ç»†ç¼–è¾‘**ï¼š
1. è¡¨æ ¼å¯ç¼–è¾‘ï¼ˆæ•°é‡ã€å•ä»·ï¼‰
2. å®æ—¶è®¡ç®—å°è®¡
3. å®æ—¶æ›´æ–°è®¢å•æ€»é‡‘é¢
4. å¯æ–°å¢/åˆ é™¤æ˜ç»†

**è®¢å•è¯¦æƒ…é¡µ-çŠ¶æ€æµè½¬**ï¼š
```
è‰ç¨¿ â†’ [ç­¾çº¦æŒ‰é’®] â†’ å·²ç­¾çº¦ â†’ [å¼€å·¥æŒ‰é’®] â†’ æ–½å·¥ä¸­ â†’ [å®Œå·¥æŒ‰é’®] â†’ å·²å®Œå·¥
```

### 3. æ•°æ®è”åŠ¨

- è®¢å•æ€»é‡‘é¢ = sum(è®¢å•æ˜ç»†.å°è®¡)
- è®¢å•æœªæ”¶é‡‘é¢ = è®¢å•æ€»é‡‘é¢ - å·²æ”¶é‡‘é¢
- å®¢æˆ·çŠ¶æ€è·Ÿéšè®¢å•çŠ¶æ€è‡ªåŠ¨æ›´æ–°

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è®¢å•æ˜ç»†å¯è°ƒæ•´**ï¼šä»å¥—é¤å¤åˆ¶è¿‡æ¥çš„æ˜ç»†å¯ä»¥éšæ„è°ƒæ•´ï¼Œä¸å½±å“å¥—é¤æ¨¡æ¿
2. **é‡‘é¢è‡ªåŠ¨è®¡ç®—**ï¼šå°è®¡ = æ•°é‡ Ã— å•ä»·ï¼Œæ€»é‡‘é¢ = sum(å°è®¡)
3. **çŠ¶æ€åªèƒ½å‰è¿›**ï¼šå®¢æˆ·çŠ¶æ€ã€è®¢å•çŠ¶æ€åªèƒ½å•å‘æµè½¬ï¼Œä¸èƒ½å›é€€
4. **æ”¶æ¬¾éœ€ç¡®è®¤**ï¼šåˆ›å»ºæ”¶æ¬¾åæ˜¯pendingçŠ¶æ€ï¼Œéœ€è´¢åŠ¡ç¡®è®¤åæ‰ç®—å·²æ”¶
5. **å·¥é•¿å¿…å¡«**ï¼šè®¢å•å¼€å·¥å‰å¿…é¡»åˆ†é…å·¥é•¿

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- APIæ–‡æ¡£ï¼šhttp://localhost:3009/api-docs
- æ¥å£åŸºåœ°å€ï¼šhttp://localhost:3009/api

**å®Œ**

