# 前端产品管理功能清单

## 📋 需要实现的页面和功能

是的！**产品套餐需要前端添加管理页面**。后端接口已经全部准备好了。

---

## 🎯 核心概念

**产品套餐** = 一组预配置好的物料清单

例如："现代简约三居室套餐" 包含：
- 地板（主材）: 100㎡ × 150元 = 15000元
- 瓷砖（主材）: 50㎡ × 80元 = 4000元
- 水泥（辅材）: 20袋 × 25元 = 500元
- 泥工（人工）: 10天 × 300元 = 3000元
- ...

**使用场景：**
1. 管理员在后台配置好各种套餐
2. 客户选择套餐后，一键创建订单
3. 订单自动包含套餐中的所有物料

---

## 📂 菜单结构建议

```
系统管理
├── 物料管理        (已有)
└── 产品套餐管理    (需要新增) ⭐
    ├── 套餐列表
    └── 套餐详情
        ├── 基本信息
        └── 物料清单
```

---

## 1️⃣ 产品套餐列表页

### 页面路径
`/products` 或 `/system/products`

### 功能需求

#### 顶部操作栏
- ✅ **新增套餐** 按钮 → 打开新增弹窗

#### 筛选区域
- ✅ 关键词搜索（套餐名称/编码）
- ✅ 状态筛选（启用/停用）

#### 表格字段
| 字段 | 说明 | 示例 |
|------|------|------|
| 套餐编码 | 后端自动生成 | `CP202510310001` |
| 套餐名称 | | 现代简约三居室套餐 |
| 成本价 | 所有物料成本合计 | ¥45,000 |
| 售价 | 对客户的售价 | ¥80,000 |
| 物料数量 | 包含多少个物料 | 15个 |
| 状态 | active/inactive | 启用/停用 |
| 操作 | 编辑 / 删除 / 查看物料 | 按钮组 |

#### 操作按钮
- **编辑** → 打开编辑弹窗
- **删除** → 二次确认后删除
- **查看物料** → 跳转到物料清单页面

---

## 2️⃣ 新增/编辑套餐弹窗

### 表单字段

```typescript
{
  name: string;          // 必填：套餐名称
  costPrice?: number;    // 可选：成本价（可自动计算）
  salePrice?: number;    // 可选：售价
  description?: string;  // 可选：套餐描述
  status?: string;       // 可选：状态（默认 active）
  sort?: number;         // 可选：排序
  remark?: string;       // 可选：备注
}
```

### 字段说明
- **套餐编码**：后端自动生成，前端不展示
- **成本价**：可以在添加物料后自动计算
- **售价**：在成本价基础上加价

### 接口调用

**新增：**
```typescript
POST /api/products
{
  "name": "现代简约三居室套餐",
  "salePrice": 80000,
  "description": "适合90-120平米三居室",
  "status": "active"
}
```

**编辑：**
```typescript
PUT /api/products/:id
{
  "salePrice": 85000,
  "description": "更新后的描述"
}
```

---

## 3️⃣ 产品物料清单页

### 页面路径
`/products/:id/materials`

### 页面布局

#### 顶部：套餐信息卡片
```
套餐名称：现代简约三居室套餐
套餐编码：CP202510310001
成本价：¥45,000   售价：¥80,000   利润：¥35,000
物料数量：15个
```

#### 中部：操作栏
- ✅ **添加物料** 按钮 → 打开物料选择弹窗

#### 下方：物料清单表格

| 字段 | 说明 | 示例 |
|------|------|------|
| 物料名称 | | 东鹏瓷砖 |
| 类别 | main/auxiliary/labor | 主材 |
| 规格 | | 800x800mm |
| 品牌 | | 东鹏 |
| 数量 | 可编辑 | 50 |
| 单位 | 可编辑 | ㎡ |
| 单价 | 可编辑 | 80.00 |
| 小计 | 自动计算 | 4,000.00 |
| 操作 | 编辑 / 删除 | 按钮组 |

#### 底部：汇总信息
```
总成本：¥45,000.00
物料总数：15个
```

---

## 4️⃣ 添加物料弹窗

### 功能需求
- ✅ 物料选择器（从物料库中选择）
- ✅ 数量输入框
- ✅ 单价输入框（默认为物料的单价，可修改）
- ✅ 单位输入框（默认为物料的单位，可修改）
- ✅ 备注输入框

### 接口调用

```typescript
POST /api/products/:id/materials
{
  "productId": 1,
  "materialId": 5,     // 选择的物料ID
  "quantity": 50,      // 数量
  "price": 80,         // 单价（可选，默认取物料单价）
  "unit": "㎡",        // 单位（可选，默认取物料单位）
  "remark": "客厅专用"
}
```

**返回示例：**
```json
{
  "id": 10,
  "productId": 1,
  "materialId": 5,
  "materialName": "东鹏瓷砖",
  "category": "main",
  "quantity": 50,
  "unit": "㎡",
  "price": 80,
  "amount": 4000,
  "remark": "客厅专用"
}
```

---

## 5️⃣ 编辑物料弹窗

### 功能需求
- ✅ 数量输入框
- ✅ 单价输入框
- ✅ 单位输入框
- ✅ 备注输入框

### 接口调用

```typescript
PUT /api/products/materials/:id
{
  "quantity": 60,
  "price": 85,
  "unit": "㎡"
}
```

---

## 📡 完整的后端接口清单

### 产品套餐基础接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/products` | 查询套餐列表 |
| GET | `/api/products/:id` | 查询套餐详情 |
| POST | `/api/products` | 创建套餐 |
| PUT | `/api/products/:id` | 更新套餐 |
| DELETE | `/api/products/:id` | 删除套餐 |

### 产品物料管理接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/products/:id/materials` | 获取套餐的物料清单 |
| POST | `/api/products/:id/materials` | 为套餐添加物料 |
| PUT | `/api/products/materials/:id` | 更新物料信息 |
| DELETE | `/api/products/materials/:id` | 删除物料 |

---

## 🎨 UI 设计建议

### 1. 套餐列表页
```
┌─────────────────────────────────────────────────┐
│ 🎁 产品套餐管理                       [+ 新增套餐] │
├─────────────────────────────────────────────────┤
│ 🔍 关键词 [       ] 状态 [全部▾] [搜索] [重置]   │
├─────────────────────────────────────────────────┤
│ □ 编码       套餐名称        成本/售价  物料  状态│
│ □ CP0001  现代简约三居室  45k/80k   15个  启用   │
│                                   [编辑] [查看物料]│
│ □ CP0002  欧式豪华别墅    120k/200k 25个  启用   │
│                                   [编辑] [查看物料]│
└─────────────────────────────────────────────────┘
```

### 2. 物料清单页
```
┌─────────────────────────────────────────────────┐
│ 现代简约三居室套餐 (CP0001)                      │
│ 成本: ¥45,000 | 售价: ¥80,000 | 利润: ¥35,000   │
├─────────────────────────────────────────────────┤
│ [+ 添加物料]                                      │
├─────────────────────────────────────────────────┤
│ 物料名称      类别  数量  单位  单价    小计      │
│ 东鹏瓷砖      主材   50   ㎡   80.00  4,000.00  │
│                                   [编辑] [删除]   │
│ 水泥         辅材   20   袋   25.00    500.00  │
│                                   [编辑] [删除]   │
├─────────────────────────────────────────────────┤
│ 总成本: ¥45,000 | 物料数: 15个                   │
└─────────────────────────────────────────────────┘
```

---

## 🔄 业务流程

### 管理员配置套餐流程
1. 进入"产品套餐管理"页面
2. 点击"新增套餐"
3. 填写套餐基本信息（名称、售价等）
4. 保存后进入物料清单页面
5. 点击"添加物料"，从物料库选择物料
6. 配置数量、单价
7. 保存，系统自动计算总成本
8. 继续添加其他物料
9. 完成后，套餐可用于创建订单

### 客户下单流程（前端）
1. 进入客户详情页
2. 点击"转订单"
3. 选择产品套餐
4. 调用 `/api/code/run/order_create_from_product` 创建订单
5. 订单自动包含套餐中的所有物料

---

## ⚠️ 注意事项

### 1. 数据一致性
- ✅ 添加物料时，物料必须存在于物料库中
- ✅ 删除物料前，检查是否有订单正在使用
- ✅ 修改物料单价后，自动重新计算小计

### 2. 权限控制
- ✅ 只有管理员可以管理产品套餐
- ✅ 普通销售只能查看和选择套餐

### 3. 用户体验
- ✅ 成本价可以根据物料清单自动计算
- ✅ 删除套餐前需要二次确认
- ✅ 添加物料时，支持模糊搜索物料名称
- ✅ 物料清单支持批量导入（可选功能）

### 4. 性能优化
- ✅ 物料清单使用虚拟滚动（物料数量多时）
- ✅ 物料选择器使用下拉懒加载
- ✅ 缓存常用的物料数据

---

## 📝 参考：物料管理页面

产品套餐管理页面可以参考物料管理页面的设计，它们的结构类似：

```
物料管理：
- 物料列表（名称、规格、品牌、单价等）
- 新增/编辑物料

产品套餐管理：
- 套餐列表（名称、成本、售价等）
- 新增/编辑套餐
- 套餐物料清单（多一层关系）
```

---

## 🚀 实现优先级

### P0（必须实现）
1. ✅ 套餐列表页（查询、新增、编辑、删除）
2. ✅ 物料清单页（查看、添加、编辑、删除物料）

### P1（重要）
3. ✅ 套餐状态管理（启用/停用）
4. ✅ 成本自动计算

### P2（可选）
5. ⭐ 批量导入物料
6. ⭐ 套餐模板（复制现有套餐）
7. ⭐ 物料使用统计

---

## 💡 技术建议

### 前端组件推荐
- **表格组件**：Ant Design Table / Element Plus Table
- **表单组件**：Ant Design Form / Element Plus Form
- **选择器**：Select with Search（支持远程搜索）
- **数字输入**：InputNumber（限制最小值0）

### 状态管理
```typescript
// Zustand / Pinia 状态示例
interface ProductStore {
  products: Product[];           // 套餐列表
  currentProduct: Product;       // 当前套餐
  materials: ProductMaterial[];  // 当前套餐的物料清单
  loading: boolean;
  
  fetchProducts: () => Promise<void>;
  fetchProductMaterials: (productId: number) => Promise<void>;
  addMaterial: (data: CreateMaterialDto) => Promise<void>;
}
```

---

## 📞 遇到问题？

如果在实现过程中遇到问题，可以查看：
1. ✅ Swagger API 文档：`http://localhost:3009/api-docs`
2. ✅ 前端对接文档：`docs/前端字段对接说明.md`
3. ✅ 物料管理的实现（作为参考）

**常见问题：**
- Q：物料编码/套餐编码需要前端生成吗？
- A：不需要，后端自动生成

- Q：成本价需要前端计算吗？
- A：后端会返回物料清单的总成本，前端可以展示

- Q：删除套餐时需要检查什么？
- A：后端会检查是否有订单使用，如有则拒绝删除

---

✅ **后端接口已全部准备就绪，可以开始前端开发了！**

